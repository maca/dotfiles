#!/usr/bin/sh

# reset rules
sudo ufw disable
sudo ufw --force reset

# set default behaviour of and enable ufw
sudo ufw default deny incoming
sudo ufw default deny outgoing

# allow local traffic
sudo ufw allow to 192.168.0.1/24
sudo ufw allow in from 192.168.0.1/24

# allow vpn connection to be established
sudo ufw allow 1300/udp

# allow vpn ip address
echo "Allowing connections from VPN server: $(dig +short ro.mullvad.net)"
sudo ufw allow in from "$(dig +short ro.mullvad.net)" to any
sudo ufw allow out from "$(dig +short ro.mullvad.net)" to any
sudo ufw allow in from "$(dig +short ro.mullvad.net)"
sudo ufw allow out from "$(dig +short ro.mullvad.net)"

# allow all traffic over VPN interface
sudo ufw allow in on tun0 from any to any
sudo ufw allow out on tun0 from any to any

# DNS issues?
sudo ufw allow 53

sudo ufw enable
